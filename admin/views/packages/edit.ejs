<%- include('../layouts/header') %>
<%- include('../layouts/sidebar') %>

<main class="bg-gray-100 min-h-screen flex justify-center px-3 sm:px-4 md:px-6 py-6 w-full md:ml-64 transition-all">
  <div class="w-full max-w-3xl">

    <!-- MOBILE HEADER -->
    <div class="relative flex items-center mb-6 md:hidden h-12">
      <button
        class="menu-btn absolute left-0 bg-blue-600 text-white p-2 rounded-lg shadow hover:bg-blue-700 transition z-10">
        ☰
      </button>
      <h1 class="w-full text-center text-lg font-semibold text-gray-800">
        Edit Package
      </h1>
    </div>

    <!-- DESKTOP HEADER -->
    <div class="hidden md:flex items-center mb-6">
      <h1 class="text-2xl font-semibold text-gray-800">
        ✏️ Edit Package
      </h1>
    </div>

    <!-- FORM CARD -->
    <div class="bg-white rounded-2xl shadow p-4 sm:p-5 md:p-6">

      <% if (error) { %>
        <div class="bg-red-100 text-red-700 p-3 rounded-lg mb-4">
          <%= error %>
        </div>
      <% } %>

      <form
        action="/admin/packages/edit/<%= pkg._id %>"
        method="POST"
        class="space-y-5"
      >

        <!-- TITLE -->
        <div>
          <label class="block text-sm font-medium mb-1">Title</label>
          <input
            type="text"
            name="title"
            required
            value="<%= pkg.title %>"
            class="w-full px-4 py-2 border rounded-lg focus:ring-2 focus:ring-blue-500 outline-none"
          />
        </div>

        <!-- DESCRIPTION -->
        <div>
          <label class="block text-sm font-medium mb-1">Description</label>
          <textarea
            name="description"
            rows="4"
            required
            class="w-full px-4 py-2 border rounded-lg resize-none focus:ring-2 focus:ring-blue-500 outline-none"
          ><%= pkg.description %></textarea>
        </div>

        <!-- LEVEL -->
        <div>
          <label class="block text-sm font-medium mb-1">Level</label>
          <select
            name="level"
            class="w-full px-4 py-2 border rounded-lg focus:ring-2 focus:ring-blue-500 outline-none"
          >
            <option value="">-- Select Level --</option>
            <option value="BEGINNER" <%= pkg.level === 'BEGINNER' ? 'selected' : '' %>>Beginner</option>
            <option value="INTERMEDIATE" <%= pkg.level === 'INTERMEDIATE' ? 'selected' : '' %>>Intermediate</option>
            <option value="ADVANCED" <%= pkg.level === 'ADVANCED' ? 'selected' : '' %>>Advanced</option>
          </select>
        </div>

        <!-- CATEGORY -->
        <div>
          <label class="block text-sm font-medium mb-1">Category</label>
          <select
            name="category"
            class="w-full px-4 py-2 border rounded-lg focus:ring-2 focus:ring-blue-500 outline-none"
          >
            <option value="">-- Select Category --</option>
            <option value="GENERAL_ENGLISH" <%= pkg.category === 'GENERAL_ENGLISH' ? 'selected' : '' %>>General English</option>
            <option value="SPOKEN_ENGLISH" <%= pkg.category === 'SPOKEN_ENGLISH' ? 'selected' : '' %>>Spoken English</option>
            <option value="EXAM_PREP" <%= pkg.category === 'EXAM_PREP' ? 'selected' : '' %>>Exam Prep (IELTS/TOEFL)</option>
            <option value="BUSINESS_ENGLISH" <%= pkg.category === 'BUSINESS_ENGLISH' ? 'selected' : '' %>>Business English</option>
          </select>
        </div>

        <!-- LESSONS -->
        <div>
          <label class="block text-sm font-medium mb-1">Number of Lessons</label>
          <select
            name="lessons"
            class="w-full px-4 py-2 border rounded-lg focus:ring-2 focus:ring-blue-500 outline-none"
          >
            <option value="">-- Select Lessons --</option>
            <option value="8" <%= pkg.lessons == 8 ? 'selected' : '' %>>8 Lessons</option>
            <option value="12" <%= pkg.lessons == 12 ? 'selected' : '' %>>12 Lessons</option>
            <option value="16" <%= pkg.lessons == 16 ? 'selected' : '' %>>16 Lessons</option>
            <option value="20" <%= pkg.lessons == 20 ? 'selected' : '' %>>20 Lessons</option>
            <option value="24" <%= pkg.lessons == 24 ? 'selected' : '' %>>24 Lessons</option>
          </select>
        </div>

        <!-- LESSON DURATION -->
        <div>
          <label class="block text-sm font-medium mb-1">Lesson Duration (minutes)</label>
          <select
            name="lessonDuration"
            class="w-full px-4 py-2 border rounded-lg focus:ring-2 focus:ring-blue-500 outline-none"
          >
            <option value="">-- Select Duration --</option>
            <option value="30" <%= pkg.lessonDuration == 30 ? 'selected' : '' %>>30 minutes</option>
            <option value="45" <%= pkg.lessonDuration == 45 ? 'selected' : '' %>>45 minutes</option>
            <option value="60" <%= pkg.lessonDuration == 60 ? 'selected' : '' %>>60 minutes</option>
            <option value="90" <%= pkg.lessonDuration == 90 ? 'selected' : '' %>>90 minutes</option>
          </select>
        </div>

        <!-- COURSES -->
        <div>
          <label class="block text-sm font-medium mb-1">Include Courses</label>
          <p class="text-xs text-gray-500 mb-1">
            Hold Ctrl (Windows) or Cmd (Mac) to select multiple courses.
          </p>

          <% const selectedCourseIds = (pkg.courses || []).map(c => c.toString()); %>

          <select
            name="courses"
            multiple
            class="w-full px-4 py-2 border rounded-lg min-h-[120px] focus:ring-2 focus:ring-blue-500 outline-none"
          >
            <% courses.forEach(course => { %>
              <option
                value="<%= course._id %>"
                <%= selectedCourseIds.includes(course._id.toString()) ? 'selected' : '' %>
              >
                <%= course.title %> (₹<%= course.price %>)
              </option>
            <% }) %>
          </select>
        </div>

        <!-- PRICING -->
        <div class="grid grid-cols-1 sm:grid-cols-2 gap-4">
          <div>
            <label class="block text-sm font-medium mb-1">Price (₹)</label>
            <input
              type="number"
              name="price"
              min="0"
              value="<%= pkg.price %>"
              class="w-full px-4 py-2 border rounded-lg focus:ring-2 focus:ring-blue-500 outline-none"
            />
          </div>
          <div>
            <label class="block text-sm font-medium mb-1">Discount Price (₹)</label>
            <input
              type="number"
              name="discountPrice"
              min="0"
              value="<%= pkg.discountPrice || '' %>"
              class="w-full px-4 py-2 border rounded-lg focus:ring-2 focus:ring-blue-500 outline-none"
            />
          </div>
        </div>

        <!-- ACCESS DURATION -->
        <div>
          <label class="block text-sm font-medium mb-1">Access Duration (days)</label>
          <input
            type="number"
            name="accessDurationDays"
            min="0"
            value="<%= pkg.accessDurationDays || '' %>"
            class="w-full px-4 py-2 border rounded-lg focus:ring-2 focus:ring-blue-500 outline-none"
          />
        </div>

        <!-- PUBLISHED -->
        <div class="flex items-center gap-2">
          <input
            type="checkbox"
            name="published"
            id="published"
            class="w-4 h-4 text-blue-600 rounded"
            <%= pkg.published ? 'checked' : '' %>
          />
          <label for="published" class="text-sm">
            Publish Package
          </label>
        </div>

        <!-- ACTION BUTTONS -->
        <div class="flex flex-col sm:flex-row gap-4 justify-end pt-2">
          <a
            href="/admin/packages"
            class="w-full sm:w-auto text-center px-6 py-2 rounded-lg border hover:bg-gray-100 transition"
          >
            Cancel
          </a>
          <button
            type="submit"
            class="w-full sm:w-auto bg-blue-600 text-white px-6 py-2 rounded-lg hover:bg-blue-700 transition"
          >
            Update Package
          </button>
        </div>

      </form>
    </div>
  </div>
</main>

<%- include('../layouts/footer') %>
